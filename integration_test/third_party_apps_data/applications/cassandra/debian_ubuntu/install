set -e

# Required to install cassandra
source /etc/os-release
if $ID == "ubuntu" && $VERSION_ID == "23.04"; then
    # There is a python dependency that fails for any older versions of cassandra on ubuntu 23
    echo "deb http://www.apache.org/dist/cassandra/debian 41x main" | sudo tee -a /etc/apt/sources.list.d/cassandra.sources.list

    # These keys had to be manually added to apt keyring to install java 8 on ubuntu 23
    sudo gpg --keyserver hkp://keyserver.ubuntu.com:80 --recv AA8E81B4331F7F50
    sudo gpg --keyserver hkp://keyserver.ubuntu.com:80 --recv 112695A0E562B32A
    sudo gpg --export --armor AA8E81B4331F7F50 | sudo apt-key add -
    sudo gpg --export --armor 112695A0E562B32A | sudo apt-key add -
else
    echo "deb http://www.apache.org/dist/cassandra/debian 311x main" | sudo tee -a /etc/apt/sources.list.d/cassandra.sources.list
fi

# Required to install java8 (JVM properties of cassandra are incompatible with >9)
echo "deb http://archive.debian.org/debian-security stretch/updates main" | sudo tee -a /etc/apt/sources.list.d/cassandra.sources.list

curl https://downloads.apache.org/cassandra/KEYS | sudo apt-key add -

sudo apt update
sudo apt install -y openjdk-8-jdk cassandra

sudo service cassandra start
