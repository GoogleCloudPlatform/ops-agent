short_name: HANA
long_name: SAP HANA
app_url: "https://www.sap.com/products/hana.html"
description: |-
  The SAP HANA integration collects SAP HANA trace logs and parses them into a
  structured log for consumption in Google Cloud Logging.
configure_integration: |-
  A monitoring user requires `SELECT` access to the relevant monitoring views. The following sql
  script should create a monitoring role and apply it to a monitoring user if executed by
  a user with sufficient permissions connected to the SAP HANA instance.

  <pre>
  --Create the user
  CREATE RESTRICTED USER otel_monitoring_user PASSWORD <password>;
  --Enable user login
  ALTER USER otel_monitoring_user ENABLE CLIENT CONNECT;
  --Create the monitoring role
  CREATE ROLE OTEL_MONITORING;
  --Grant permissions to the relevant views
  GRANT CATALOG READ TO OTEL_MONITORING;
  GRANT SELECT ON SYS.M_BACKUP_CATALOG TO OTEL_MONITORING;
  GRANT SELECT ON SYS.M_BLOCKED_TRANSACTIONS TO OTEL_MONITORING;
  GRANT SELECT ON SYS.M_CONNECTIONS TO OTEL_MONITORING;
  GRANT SELECT ON SYS.M_CS_ALL_COLUMNS TO OTEL_MONITORING;
  GRANT SELECT ON SYS.M_CS_TABLES TO OTEL_MONITORING;
  GRANT SELECT ON SYS.M_DATABASE TO OTEL_MONITORING;
  GRANT SELECT ON SYS.M_DISKS TO OTEL_MONITORING;
  GRANT SELECT ON SYS.M_HOST_RESOURCE_UTILIZATION TO OTEL_MONITORING;
  GRANT SELECT ON SYS.M_LICENSES TO OTEL_MONITORING;
  GRANT SELECT ON SYS.M_RS_TABLES TO OTEL_MONITORING;
  GRANT SELECT ON SYS.M_SERVICE_COMPONENT_MEMORY TO OTEL_MONITORING;
  GRANT SELECT ON SYS.M_SERVICE_MEMORY TO OTEL_MONITORING;
  GRANT SELECT ON SYS.M_SERVICE_REPLICATION TO OTEL_MONITORING;
  GRANT SELECT ON SYS.M_SERVICE_STATISTICS TO OTEL_MONITORING;
  GRANT SELECT ON SYS.M_SERVICE_THREADS TO OTEL_MONITORING;
  GRANT SELECT ON SYS.M_SERVICES TO OTEL_MONITORING;
  GRANT SELECT ON SYS.M_VOLUME_IO_TOTAL_STATISTICS TO OTEL_MONITORING;
  GRANT SELECT ON SYS.M_WORKLOAD TO OTEL_MONITORING;
  GRANT SELECT ON _SYS_STATISTICS.STATISTICS_CURRENT_ALERTS TO OTEL_MONITORING;
  --Add the OTEL_MONITOR role to the monitoring user
  GRANT OTEL_MONITORING TO otel_monitoring_user;
  </pre>
supported_app_version: ["2.0"]
expected_metrics:
expected_logs:
- log_name: saphana_trace
  fields:
  - name: jsonPayload.message
    value_regex: "*"
    type: string
    description: Log message
configuration_options:
  logs:
  - type: saphana_trace
    fields:
    - name: type
      default: null
      description: The value must be saphana_trace.
    - name: include_paths
      default: '[/usr/sap/*/HDB*/${HOSTNAME}/trace/*.trc]'
      description: A list of filesystem paths to read by tailing each file. A wild card (*) can be used in the paths.
    - name: exclude_paths
      default: '[/usr/sap/*/HDB*/${HOSTNAME}/trace/nameserver_history*.trc, /usr/sap/*/HDB*/${HOSTNAME}/trace/nameserver*loads*.trc, /usr/sap/*/HDB*/${HOSTNAME}/trace/nameserver*executed_statements*.trc]'
      description: A list of filesystem path patterns to exclude from the set matched by include_paths.
    - name: wildcard_refresh_interval
      default: 60s
      description: The interval at which wildcard file paths in include_paths are refreshed. Given as a time duration, for example 30s or 2m. This property might be useful under high logging throughputs where log files are rotated faster than the default interval.
