# SAP HANA is pre-installed on the images used for tests
set -e

# Check for running services
ps -ef | grep hdb

# Start the instance
sudo su - opsadm -c '/usr/sap/OPS/HDB00/HDB stop'
sudo su - opsadm -c '/usr/sap/OPS/HDB00/exe/hdbpreprocessor'
sudo su - opsadm -c '/usr/sap/OPS/HDB00/exe/hdbcompileserver'
sudo su - opsadm -c '/usr/sap/OPS/HDB00/exe/hdbnameserver'
sudo su - opsadm -c '/usr/sap/OPS/HDB00/exe/hdbindexserver'
sudo su - opsadm -c '/usr/sap/OPS/HDB00/HDB start'

# Check that the instance is up
sudo su - opsadm -c '/usr/sap/OPS/HDB00/exe/hdbsql -u SYSTEM -j "SELECT * FROM DUMMY"'