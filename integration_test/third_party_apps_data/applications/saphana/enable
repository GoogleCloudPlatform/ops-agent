# Configures Ops Agent to collect telemetry from the app and restart Ops Agent.

set -e

sudo tee /etc/google-cloud-ops-agent/config.yaml > /dev/null << EOF

logging:
  receivers:
    saphana_trace:
      type: saphana_trace
      include_paths:
        - "/usr/sap/*/HDB*/saphanamon/trace/*.trc"
      exclude_paths:
        - "/usr/sap/*/HDB*/saphanamon/trace/nameserver_history*.trc"
			  - "/usr/sap/*/HDB*/saphanamon/trace/nameserver*loads*.trc"
			  - "/usr/sap/*/HDB*/saphanamon/trace/nameserver*executed_statements*.trc"
  service:
    pipelines:
      saphana:
        receivers:
          - saphana_trace
EOF

sudo service google-cloud-ops-agent restart
