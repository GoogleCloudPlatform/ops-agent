set -e

sudo zypper install -y curl java-11-openjdk

curl -L -o flink.tgz https://archive.apache.org/dist/flink/flink-1.12.5/flink-1.12.5-bin-scala_2.12.tgz

sudo mkdir /opt/flink
sudo tar -xzf flink.tgz -C /opt/flink --strip-components 1

cat <<EOF | sudo tee /etc/systemd/system/flink.service
[Unit]
Description=Apache Flink
           
[Service]
Type=forking
User=root
Group=root
ExecStart=/opt/flink/bin/start-cluster.sh
ExecStop=/opt/flink/bin/stop-cluster.sh
Restart=always
           
[Install]
WantedBy=default.target
EOF

sudo systemctl enable flink

sudo systemctl restart flink
