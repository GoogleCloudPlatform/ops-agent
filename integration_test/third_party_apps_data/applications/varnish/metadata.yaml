short_name: varnish
long_name: Varnish HTTP Cache
logo_path: /images/partners/varnish-logo.png # supplied by google technical writer
description: |-
  The Varnish integration collects cache and session metrics.
  It monitors the number of objects entering and exiting the cache,
  as well as the number of sessions and backend connections.
  The integration also collects Varnish access logs and parses them
  into a standardized json payload.
  For more information about Varnish, see
  [Varnish HTTP Cache](https://varnish-cache.org/).
supported_app_version: ["6.x", "7.0.x"]
expected_metrics:
- type: workload.googleapis.com/varnish.backend.connection.count
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels:
    kind: .*
  representative: true
- type: workload.googleapis.com/varnish.backend.request.count
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels: {}
- type: workload.googleapis.com/varnish.cache.operation.count
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels:
    operation: .*
- type: workload.googleapis.com/varnish.client.request.count
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels:
    state: .*
- type: workload.googleapis.com/varnish.client.request.error.count
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels:
    status_code: .*
- type: workload.googleapis.com/varnish.object.count
  value_type: INT64
  kind: GAUGE
  monitored_resource: gce_instance
  labels: {}
- type: workload.googleapis.com/varnish.object.expired
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels: {}
- type: workload.googleapis.com/varnish.object.moved
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels: {}
- type: workload.googleapis.com/varnish.object.nuked
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels: {}
- type: workload.googleapis.com/varnish.session.count
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels:
    kind: .*
- type: workload.googleapis.com/varnish.thread.operation.count
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels:
    operation: .*
configuration_options:
  metrics:
  - type: varnish
    fields:
    - name: type
      default: null
      description: This value must be varnish.
    - name: cache_dir
      default: null
      description: This specifies the cache dir instance name to use when collecting metrics. If not specified, this will default to the host.
    - name: exec_dir
      default: null
      description: The directory where the varnishadm and varnishstat executables are located. If not provided, will default to relying on the executables being in the user's PATH.
    - name: collection_interval
      default: 60s
      description: A time.Duration value, such as 30s or 5m.
minimum_supported_agent_version:
  metrics: 2.15.0
expected_logs:
- log_name: varnish
  fields:
  - name: httpRequest.serverIp
    type: string
    description: The IP address of the origin server that the request was sent to
  - name: httpRequest.remoteIp
    type: string
    description: The IP address of the client that issued the HTTP request
  - name: timestamp`
    type: string
    description: Time the request was received
  - name: httpRequest.requestMethod
    type: string
    description: HTTP method
  - name: httpRequest.requestUrl
    type: string
    description: Request URL (typically just the path part of the URL
  - name: httpRequest.protocol
    type: string
    description: Protocol used for the request
  - name: httpRequest.status
    type: string
    description: HTTP status code
  - name: httpRequest.responseSize
    type: string
    description: Response size
  - name: httpRequest.referer
    type: string
    description: Contents of the `Referer` header
  - name: httpRequest.userAgent
    type: string
    description: Contents of the `User-Agent` header
