public_url: "https://cloud.google.com/stackdriver/docs/solutions/agents/ops-agent/third-party/couchdb"
short_name: CouchDB
long_name: Apache CouchDB
description: |-
  The Apache CouchDB integration collects traffic-related metrics, such as the
  number of requests to a node and responses from the node. It also collects
  database metrics, such as how many are open and the number of operations. The
  integration collects general CouchDB and access logs and parses them into a JSON
  payload. The result includes fields for user, host, level, and message.

  For more information about Apache CouchDB, see
  [couchdb.apache.org/](https://couchdb.apache.org/).
minimum_supported_agent_version:
  metrics: 2.10.0
  logging: 2.11.0
supported_app_version: ["2.3+", "3.1+"]
expected_metrics:
- type: workload.googleapis.com/couchdb.average_request_time
  value_type: DOUBLE
  kind: GAUGE
  monitored_resource: gce_instance
  labels: {}
- type: workload.googleapis.com/couchdb.database.open
  value_type: INT64
  kind: GAUGE
  monitored_resource: gce_instance
  labels: {}
  representative: true
- type: workload.googleapis.com/couchdb.database.operations
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels:
    operation: .*
- type: workload.googleapis.com/couchdb.file_descriptor.open
  value_type: INT64
  kind: GAUGE
  monitored_resource: gce_instance
  labels: {}
- type: workload.googleapis.com/couchdb.httpd.bulk_requests
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels: {}
- type: workload.googleapis.com/couchdb.httpd.requests
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels:
    http_method: .*
- type: workload.googleapis.com/couchdb.httpd.responses
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels:
    http_status_code: .*
- type: workload.googleapis.com/couchdb.httpd.views
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels:
    view: .*
expected_logs:
- log_name: couchdb
  fields:
  - name: jsonPayload.node
    value_regex: couchdb
    type: string
    description: node instance name
  - name: jsonPayload.path
    value_regex: /forbidden
    type: string
    description: request path
  - name: jsonPayload.remote_user
    value_regex: undefined
    type: string
    description: Authenticated username for the request
  - name: jsonPayload.status_message
    value_regex: ok
    type: string
    description: status code message
  - name: jsonPayload.pid
    type: string
    description: Process ID
  - name: jsonPayload.message
    type: string
    description: Log message
  - name: jsonPayload.host
    type: string
    description: host instance name
  - name: httpRequest
    type: object
    description: Information about the HTTP request associated with this log entry, if applicable. It's availble in access logs.
configuration_options:
  logs:
  - type: "couchdb"
    fields:
    - name: type
      default: null
      description: "The value must be couchdb."
    - name: include_paths
      default: '[/var/log/couchdb/couchdb.log]'
      description: A list of filesystem paths to read by tailing each file. A wild card (*) can be used in the paths; for example, /var/log/couchdb*/*.log.
    - name: exclude_paths
      default: null
      description: A list of filesystem path patterns to exclude from the set matched by include_paths.
    - name: wildcard_refresh_interval
      default: 60s
      description: The interval at which wildcard file paths in include_paths are refreshed. Given as a time duration, for example 30s or 2m. This property might be useful under high logging throughputs where log files are rotated faster than the default interval.
  metrics:
  - type: couchdb
    fields:
    - name: type
      default: null
      description: The value must be couchdb.
    - name: server_status_url
      default: 	http://localhost:5984
      description: The URL exposed by couchdb.
    - name: username
      default: null
      description: The username used to connect to the server.
    - name: password
      default: null
      description: The password used to connect to the server.
    - name: collection_interval
      default: 60s
      description: A time.Duration value, such as 30s or 5m.
