# The built-in Ops Agent already includes the nvml receiver in the default pipeline.

# A back up of the existing file is required as part of the test framework check.
sudo cp /etc/google-cloud-ops-agent/config.yaml /etc/google-cloud-ops-agent/config.yaml.bak

# build and run a test application that generates CUDA traffic
wget https://raw.githubusercontent.com/suffiank/ops-agent/sufkha/nvml-and-dcgm/integration_test/third_party_apps_data/applications/nvml/testcudakernel/test_cuda_kernel.cc
g++ -I/usr/local/cuda/include test_cuda_kernel.cc -L/usr/local/cuda/lib64 -lcublas -lcudart -o loopcudakernel
nohup ./loopcudakernel </dev/null >loopcuda.out 2>&1 &
echo "Submitted ./loopcudakernel as pid $!"

sleep 5
nvidia-smi
