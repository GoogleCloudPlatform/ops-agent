set -e

sudo systemctl restart wildfly

timeout 60s bash <<EOF
wait_for_wildfly() {
    until curl localhost:9990 > /dev/null 2>&1
    do
        echo "Waiting for wildfly to start. . ."
        sleep "1"
    done
}

wait_for_wildfly

sleep 5
echo "Wildfly started"
EOF

sudo /opt/wildfly/bin/add-user.sh otelu otelp --silent