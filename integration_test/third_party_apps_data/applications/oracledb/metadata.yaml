# Copyright 2022 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

app_url: "https://www.oracle.com/database/"
short_name: Oracle DB
long_name: Oracle Database
description: |-
  The Oracle DB integration collects Oracle DB metrics and logs. The metrics are collected by querying
  relevant monitoring views. This integration writes structured trace logs.
configure_integration: |-
  To collect metrics, a monitoring user requires `SELECT` access to the relevant views. The following sql
  script should create a monitoring user and give it the appropriate permissions if executed by
  a user with sufficient permissions connected to the Oracle DB instance as SYSDBA or SYSOPER.

  <pre>
  -- Create the monitoring user "otel"
  CREATE USER otel IDENTIFIED BY <authentication password>;

  -- Grant the "otel" user the required permissions
  GRANT CONNECT TO otel;
  GRANT SELECT ON GV_$DATABASE to otel;
  GRANT SELECT ON GV_$INSTANCE to otel;
  GRANT SELECT ON GV_$PROCESS to otel;
  GRANT SELECT ON GV_$RESOURCE_LIMIT to otel;
  GRANT SELECT ON GV_$SYSMETRIC to otel;
  GRANT SELECT ON GV_$SYSSTAT to otel;
  GRANT SELECT ON GV_$SYSTEM_EVENT to otel;
  GRANT SELECT ON V_$RMAN_BACKUP_JOB_DETAILS to otel;
  GRANT SELECT ON V_$SORT_SEGMENT to otel;
  GRANT SELECT ON V_$TABLESPACE to otel;
  GRANT SELECT ON V_$TEMPFILE to otel;
  GRANT SELECT ON SYS.DBA_DATA_FILES to otel;
  GRANT SELECT ON SYS.DBA_FREE_SPACE to otel;
  GRANT SELECT ON SYS.DBA_TABLESPACE_USAGE_METRICS to otel;
  GRANT SELECT ON SYS.DBA_TABLESPACES to otel;
  GRANT SELECT ON SYS.GLOBAL_NAME to otel;
  </pre>
supported_operating_systems: linux
supported_app_version: ["12.2", "18c", "19c", "21c"]
expected_metrics: [] #Work in progress
expected_logs:
  - log_name: oracledb_alert
    fields:
      - name: jsonPayload.message
        type: string
        description: Log message
      - name: severity
        type: string
        description: ''
configuration_options:
  metrics:
    - type: oracledb
      fields:
        - default: null
          description: This value must be oracledb.
          name: type
        - default: localhost:1522
          description: The endpoint used to connect to the oracle DB instance. This field supports either host:port or a unix socket path.
          name: endpoint
        - default: 60s
          description: A time.Duration value, such as 30s or 5m.
          name: collection_interval
        - default: null
          description: The username used to connect to the instance.
          name: username
        - default: null
          description: The password used to connect to the instance.
          name: password
        - default: true
          description: Sets whether or not to use a secure TLS connection. If set to false, then TLS is enabled.
          name: insecure
        - default: false
          description: Sets whether or not to skip verifying the certificate. If insecure is set to true, then the insecure_skip_verify value is not used.
          name: insecure_skip_verify
        - default: null
          description: Path to the oracle wallet optionally used for authentication and securing connections.
          name: wallet
        - default: null
          description: The SID of the Oracle database being monitored. Use this _or_ service_name as appropriate.
          name: sid
        - default: null
          description: The Service Name of the Oracle database being monitored. Use this _or_ sid as appropriate.
          name: service_name
  logs:
    - type: oracledb_audit
      fields:
        - name: type
          default: null
          description: The value must be oracledb_audit.
        - name: include_paths
          default: '[$ORACLE_HOME/admin/*/adump/*.aud]'
          description: A list of filesystem paths to read by tailing each file. A wild card (*) can be used in the paths.
        - name: exclude_paths
          default: '[]'
          description: A list of filesystem path patterns to exclude from the set matched by include_paths.
        - name: record_log_file_path
          default: false
          description: If set to `true`, then the path to the specific file from which the log record was obtained appears in the output log entry as the value of the `agent.googleapis.com/log_file_path` label. When using a wildcard, only the path of the file from which the record was obtained is recorded.
        - name: wildcard_refresh_interval
          default: 60s
          description: The interval at which wildcard file paths in include_paths are refreshed. Given as a time duration, for example 30s or 2m. This property might be useful under high logging throughputs where log files are rotated faster than the default interval.
    - type: oracledb_alert
      fields:
        - name: type
          default: null
          description: The value must be oracledb_alert.
        - name: include_paths
          default: '[$ORACLE_HOME/diag/rdbms/*/*/trace/alert_*.log]'
          description: A list of filesystem paths to read by tailing each file. A wild card (*) can be used in the paths.
        - name: exclude_paths
          default: '[]'
          description: A list of filesystem path patterns to exclude from the set matched by include_paths.
        - name: record_log_file_path
          default: false
          description: If set to `true`, then the path to the specific file from which the log record was obtained appears in the output log entry as the value of the `agent.googleapis.com/log_file_path` label. When using a wildcard, only the path of the file from which the record was obtained is recorded.
        - name: wildcard_refresh_interval
          default: 60s
          description: The interval at which wildcard file paths in include_paths are refreshed. Given as a time duration, for example 30s or 2m. This property might be useful under high logging throughputs where log files are rotated faster than the default interval.
minimum_supported_agent_version:
  metrics: 2.18.1
  logging: 2.18.1
public_url: https://cloud.google.com/stackdriver/docs/solutions/agents/ops-agent/third-party/saphana
