public_url: "https://cloud.google.com/stackdriver/docs/solutions/agents/ops-agent/third-party/solr"
app_url: "https://solr.apache.org/"
short_name: Solr
long_name: Apache Solr
logo_path: /stackdriver/images/solr.png # supplied by google technical writer
description: |-
  The Apache Solr integration collects core and cache metrics. Core metrics focus
  on requests, document count, and index size. Cache metrics focus on cache
  utilization. The integration also collects Solr logs and parses them into a
  JSON payload. The result includes fields for shard, replica, core,
  level, and message.
configure_integration: |-
  To expose a JMX endpoint, you must set the `com.sun.management.jmxremote.port`
  system property when starting the JVM. We also recommend setting the
  `com.sun.management.jmxremote.rmi.port` system property to the same port. To
  expose a JMX endpoint remotely, you must also set the `java.rmi.server.hostname`
  system property.

  By default, these properties are set in a Solr deployment's
  `solr-env.sh` file.

  To set system properties by using command-line arguments, prepend the property
  name with `-D` when starting the JVM. For example, to set
  `com.sun.management.jmxremote.port` to port `18983`, specify the following when
  starting the JVM:

  <pre>
  -Dcom.sun.management.jmxremote.port=18983
  </pre>
minimum_supported_agent_version:
  metrics: 2.10.0
  logging: 2.10.0
supported_operating_systems: linux
supported_app_version: ["8.x", "7.7"]
expected_metrics:
- type: workload.googleapis.com/solr.cache.eviction.count
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels:
    cache: .*
    core: .*
- type: workload.googleapis.com/solr.cache.hit.count
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels:
    cache: .*
    core: .*
- type: workload.googleapis.com/solr.cache.insert.count
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels:
    cache: .*
    core: .*
- type: workload.googleapis.com/solr.cache.lookup.count
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels:
    cache: .*
    core: .*
- type: workload.googleapis.com/solr.cache.size
  value_type: INT64
  kind: GAUGE
  monitored_resource: gce_instance
  labels:
    cache: .*
    core: .*
  representative: true
- type: workload.googleapis.com/solr.document.count
  value_type: INT64
  kind: GAUGE
  monitored_resource: gce_instance
  labels:
    core: .*
- type: workload.googleapis.com/solr.index.size
  value_type: INT64
  kind: GAUGE
  monitored_resource: gce_instance
  labels:
    core: .*
- type: workload.googleapis.com/solr.request.count
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels:
    core: .*
    handler: .*
    type: .*
- type: workload.googleapis.com/solr.request.error.count
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels:
    core: .*
    handler: .*
    type: .*
- type: workload.googleapis.com/solr.request.time.average
  value_type: DOUBLE
  kind: GAUGE
  monitored_resource: gce_instance
  labels:
    core: .*
    handler: .*
    type: .*
- type: workload.googleapis.com/solr.request.timeout.count
  value_type: INT64
  kind: CUMULATIVE
  monitored_resource: gce_instance
  labels:
    core: .*
    handler: .*
    type: .*
expected_logs:
- log_name: solr_system
  fields:
  - name: jsonPayload.message
    value_regex: " ___      _       Welcome to Apache Solrâ„¢ version 8.11.1"
    type: string
    description: Log message
  - name: jsonPayload.thread
    value_regex: main
    type: string
    description: Thread where the log originated
  - name: jsonPayload.source
    value_regex: o.a.s.s.SolrDispatchFilter
    type: string
    description: Source of where the log originated
  - name: jsonPayload.collection
    type: string
    description: Solr collection related to the log
  - name: jsonPayload.shard
    type: string
    description: Solr shard related to the log
  - name: jsonPayload.replica
    type: string
    description: Solr replica related to the log
  - name: jsonPayload.core
    type: string
    description: Solr core related to the log
  - name: jsonPayload.exception
    type: string
    description: Exception related to the log, including detailed stacktrace where provided
configuration_options:
  logs:
  - type: solr_system
    fields:
    - name: type
      default: null
      description: The value must be solr_system.
    - name: include_paths
      default: '[/var/solr/logs/solr.log]'
      description: A list of filesystem paths to read by tailing each file. A wild card (*) can be used in the paths.
    - name: exclude_paths
      default: null
      description: A list of filesystem path patterns to exclude from the set matched by include_paths.
    - name: record_log_file_path
      default: false
      description: If set to `true`, then the path to the specific file from which the log record was obtained appears in the output log entry as the value of the `agent.googleapis.com/log_file_path` label. When using a wildcard, only the path of the file from which the record was obtained is recorded.
    - name: wildcard_refresh_interval
      default: 60s
      description: The interval at which wildcard file paths in include_paths are refreshed. Given as a time duration, for example 30s or 2m. This property might be useful under high logging throughputs where log files are rotated faster than the default interval.
  metrics:
  - type: solr
    fields:
    - name: type
      default: null
      description: This value must be solr.
    - name: endpoint
      default: localhost:18983
      description: The JMX Service URL or host and port used to construct the Service URL. Must be in the form of host:port. Values in host:port form will be used to create a Service URL of service:jmx:rmi:///jndi/rmi://<host>:<port>/jmxrmi.
    - name: username
      default: null
      description: The configured username if JMX is configured to require authentication..
    - name: password
      default: null
      description: The configured password if JMX is configured to require authentication.
    - name: collection_interval
      default: 60s
      description: A time.Duration value, such as 30s or 5m.
