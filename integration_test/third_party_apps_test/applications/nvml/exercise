set -e

# Run the gpu burn with a large range to create a process that uses
# GPU for a period that is longer than default collection interval of 60s
git clone https://github.com/wilicc/gpu-burn
cd gpu-burn
DEVICE_CODE=$(lspci -n | grep -Po '10de:[\w\d]{4}')
case $DEVICE_CODE in
    # V100 | P4 | P100
    # Device PCIe ID lookup: https://envytools.readthedocs.io/en/latest/hw/pciid.html
    10de:1db1|10de:1bb3|10de:15f8)
        make COMPUTE=60
        ;;
    *)
        make
        ;;
esac
./gpu_burn -d 180
