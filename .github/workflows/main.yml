on: [push, pull_request]
name: Test
jobs:
  test:
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, windows-latest]
    runs-on: ${{matrix.os}}
    steps:
    - uses: actions/setup-go@v2
      with:
        go-version: 1.x
    - run: go get golang.org/x/tools/cmd/goimports
    - run: git config --global core.symlinks true
    - uses: actions/checkout@v2
    - if: ${{ startsWith(runner.os, 'ubuntu-') }}
      run: if [ $(goimports -l .) ]; then goimports -d .; echo 'Failed the goimports format check. Please format the code using "goimports -w ."'; exit 1; fi
    - run: go test -mod=mod -coverprofile=coverage/lcov.info ./...
    - uses: coverallsapp/github-action@master
      with:
        github-token: ${{ secrets.github_token }}

