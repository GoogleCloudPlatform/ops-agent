exporters:
  googlecloud:
    metric:
      prefix: agent.googleapis.com/
    user_agent: Google-Cloud-Ops-Agent-Metrics/latest (BuildDistro=build_distro;Platform=linux;ShortName=linux_platform;ShortVersion=linux_platform_version)
processors:
  agentmetrics/default__pipeline_hostmetrics_0:
    blank_label_metrics:
    - system.cpu.utilization
  filter/agent_0:
    metrics:
      include:
        match_type: strict
        metric_names:
        - otelcol_process_uptime
        - otelcol_process_memory_rss
        - otelcol_grpc_io_client_completed_rpcs
        - otelcol_googlecloudmonitoring_point_count
  filter/default__pipeline_hostmetrics_1:
    metrics:
      exclude:
        match_type: strict
        metric_names:
        - system.cpu.time
        - system.network.dropped
        - system.filesystem.inodes.usage
        - system.paging.faults
        - system.disk.operation_time
        - system.processes_count
  filter/default__pipeline_hostmetrics_3:
    metrics:
      exclude:
        match_type: regexp
        metric_names:
        - ^proce.*ses/.*$
        - ^c.*u/.*$
  metricstransform/agent_1:
    transforms:
    - action: update
      metric_name: otelcol_process_uptime
      new_name: agent/uptime
      operations:
      - action: toggle_scalar_data_type
      - action: add_label
        label: version
        new_label: google-cloud-ops-agent-metrics/latest-build_distro
    - action: update
      metric_name: otelcol_process_memory_rss
      new_name: agent/memory_usage
      operations: []
    - action: update
      metric_name: otelcol_grpc_io_client_completed_rpcs
      new_name: agent/api_request_count
      operations:
      - action: toggle_scalar_data_type
      - action: update_label
        label: grpc_client_status
        new_label: state
      - action: aggregate_labels
        aggregation_type: sum
        label_set:
        - state
    - action: update
      metric_name: metricotelcol_googlecloudmonitoring_point_count
      new_name: agent/monitoring/point_count
      operations:
      - action: toggle_scalar_data_type
  metricstransform/default__pipeline_hostmetrics_2:
    transforms:
    - action: update
      metric_name: system.cpu.time
      new_name: cpu/usage_time
      operations:
      - action: toggle_scalar_data_type
      - action: update_label
        label: cpu
        new_label: cpu_number
      - action: update_label
        label: state
        new_label: cpu_state
    - action: update
      metric_name: system.cpu.utilization
      new_name: cpu/utilization
      operations:
      - action: aggregate_labels
        aggregation_type: mean
        label_set:
        - state
        - blank
      - action: update_label
        label: blank
        new_label: cpu_number
      - action: update_label
        label: state
        new_label: cpu_state
    - action: update
      metric_name: system.cpu.load_average.1m
      new_name: cpu/load_1m
      operations: []
    - action: update
      metric_name: system.cpu.load_average.5m
      new_name: cpu/load_5m
      operations: []
    - action: update
      metric_name: system.cpu.load_average.15m
      new_name: cpu/load_15m
      operations: []
    - action: update
      metric_name: system.disk.read_io
      new_name: disk/read_bytes_count
      operations: []
    - action: update
      metric_name: system.disk.write_io
      new_name: disk/write_bytes_count
      operations: []
    - action: update
      metric_name: system.disk.operations
      new_name: disk/operation_count
      operations: []
    - action: update
      metric_name: system.disk.io_time
      new_name: disk/io_time
      operations:
      - action: experimental_scale_value
        experimental_scale: 1000.0
      - action: toggle_scalar_data_type
    - action: update
      metric_name: system.disk.weighted_io_time
      new_name: disk/weighted_io_time
      operations:
      - action: experimental_scale_value
        experimental_scale: 1000.0
      - action: toggle_scalar_data_type
    - action: update
      metric_name: system.disk.average_operation_time
      new_name: disk/operation_time
      operations:
      - action: experimental_scale_value
        experimental_scale: 1000.0
      - action: toggle_scalar_data_type
    - action: update
      metric_name: system.disk.pending_operations
      new_name: disk/pending_operations
      operations:
      - action: toggle_scalar_data_type
    - action: update
      metric_name: system.disk.merged
      new_name: disk/merged_operations
      operations: []
    - action: update
      metric_name: system.filesystem.usage
      new_name: disk/bytes_used
      operations:
      - action: toggle_scalar_data_type
      - action: aggregate_labels
        aggregation_type: sum
        label_set:
        - device
        - state
    - action: update
      metric_name: system.filesystem.utilization
      new_name: disk/percent_used
      operations:
      - action: aggregate_labels
        aggregation_type: sum
        label_set:
        - device
        - state
    - action: update
      metric_name: system.memory.usage
      new_name: memory/bytes_used
      operations:
      - action: toggle_scalar_data_type
      - action: aggregate_label_values
        aggregated_values:
        - slab_reclaimable
        - slab_unreclaimable
        aggregation_type: sum
        label: state
        new_value: slab
    - action: update
      metric_name: system.memory.utilization
      new_name: memory/percent_used
      operations:
      - action: aggregate_label_values
        aggregated_values:
        - slab_reclaimable
        - slab_unreclaimable
        aggregation_type: sum
        label: state
        new_value: slab
    - action: update
      metric_name: system.network.io
      new_name: interface/traffic
      operations:
      - action: update_label
        label: interface
        new_label: device
      - action: update_label
        label: direction
        value_actions:
        - new_value: rx
          value: receive
        - new_value: tx
          value: transmit
    - action: update
      metric_name: system.network.errors
      new_name: interface/errors
      operations:
      - action: update_label
        label: interface
        new_label: device
      - action: update_label
        label: direction
        value_actions:
        - new_value: rx
          value: receive
        - new_value: tx
          value: transmit
    - action: update
      metric_name: system.network.packets
      new_name: interface/packets
      operations:
      - action: update_label
        label: interface
        new_label: device
      - action: update_label
        label: direction
        value_actions:
        - new_value: rx
          value: receive
        - new_value: tx
          value: transmit
    - action: update
      metric_name: system.network.connections
      new_name: network/tcp_connections
      operations:
      - action: toggle_scalar_data_type
      - action: delete_label_value
        label: protocol
        label_value: udp
      - action: update_label
        label: state
        new_label: tcp_state
      - action: aggregate_labels
        aggregation_type: sum
        label_set:
        - tcp_state
      - action: add_label
        label: port
        new_label: all
    - action: update
      metric_name: system.processes.created
      new_name: processes/fork_count
      operations: []
    - action: update
      metric_name: system.paging.usage
      new_name: swap/bytes_used
      operations:
      - action: toggle_scalar_data_type
    - action: update
      metric_name: system.paging.utilization
      new_name: swap/percent_used
      operations: []
    - action: insert
      metric_name: swap/percent_used
      new_name: pagefile/percent_used
      operations:
      - action: aggregate_labels
        aggregation_type: sum
        label_set:
        - state
    - action: update
      metric_name: system.paging.operations
      new_name: swap/io
      operations:
      - action: aggregate_labels
        aggregation_type: sum
        label_set:
        - direction
      - action: update_label
        label: direction
        value_actions:
        - new_value: in
          value: page_in
        - new_value: out
          value: page_out
    - action: update
      metric_name: process.cpu.time
      new_name: processes/cpu_time
      operations:
      - action: experimental_scale_value
        experimental_scale: 1e+06.0
      - action: toggle_scalar_data_type
      - action: add_label
        label: process
        new_label: all
      - action: delete_label_value
        label: state
        label_value: wait
      - action: update_label
        label: state
        new_label: user_or_syst
      - action: update_label
        label: user_or_syst
        value_actions:
        - new_value: syst
          value: system
    - action: update
      metric_name: process.disk.read_io
      new_name: processes/disk/read_bytes_count
      operations:
      - action: add_label
        label: process
        new_label: all
    - action: update
      metric_name: process.disk.write_io
      new_name: processes/disk/write_bytes_count
      operations:
      - action: add_label
        label: process
        new_label: all
    - action: update
      metric_name: process.memory.physical_usage
      new_name: processes/rss_usage
      operations:
      - action: toggle_scalar_data_type
      - action: add_label
        label: process
        new_label: all
    - action: update
      metric_name: process.memory.virtual_usage
      new_name: processes/vm_usage
      operations:
      - action: toggle_scalar_data_type
      - action: add_label
        label: process
        new_label: all
receivers:
  hostmetrics/default__pipeline_hostmetrics:
    collection_interval: 60s
    scrapers:
      cpu: {}
      disk: {}
      filesystem: {}
      load: {}
      memory: {}
      network: {}
      paging: {}
      process: {}
      processes: {}
  prometheus/agent:
    config:
      scrape_configs:
      - job_name: otel-collector
        scrape_interval: 1m
        static_configs:
        - targets:
          - 0.0.0.0:8888
service:
  pipelines:
    agent:
      exporters: googlecloud
      processors:
      - filter/agent_0
      - metricstransform/agent_1
      receivers:
      - prometheus/agent
    default__pipeline_hostmetrics:
      exporters: googlecloud
      processors:
      - agentmetrics/default__pipeline_hostmetrics_0
      - filter/default__pipeline_hostmetrics_1
      - metricstransform/default__pipeline_hostmetrics_2
      - filter/default__pipeline_hostmetrics_3
      receivers:
      - hostmetrics/default__pipeline_hostmetrics
